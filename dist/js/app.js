"use strict";function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:55.946298,lng:-3.189972},scrollwheel:!0,zoom:13}),infowindow=new google.maps.InfoWindow,ko.applyBindings(new ViewModel)}var map,infowindow,marker,initialShows=[{show:"My Condo",venue:"",address:"4 North East Circus Place",zipcode:"EH3 6SP",LatLng:{lat:55.957603,lng:-3.203525},imgSrc:"images/mycondo.png"},{show:"American Idiot",venue:"Greenside",address:"1 b Royal Terrace",zipcode:"EH7 5AB",LatLng:{lat:55.957466,lng:-3.182602},imgSrc:"images/americanidiot.jpg"},{show:"Colin Cloud",venue:"Underbelly Med Quad",address:"Teviot Place",zipcode:"EH8 9AG",LatLng:{lat:55.94441,lng:-3.190305},imgSrc:"images/colincloud.jpg"},{show:"Fawlty Towers",venue:"Best Restaurant",address:"16 Drummond Street",zipcode:"EH8 9TX",LatLng:{lat:55.947355,lng:-3.185113},imgSrc:"images/fawltytowers.jpg"},{show:"Kit Hesketh-Harvey",venue:"G & V Royal Mile Hotel",address:"1 George IV Bridge",zipcode:"EH1 1AD",LatLng:{lat:55.948985,lng:-3.192447},imgSrc:"images/kithesketh.jpg"},{show:"Jesus Christ Superstar",venue:"Edinburgh Tabernacle",address:"41-43 Inverleith Gardens",zipcode:"EH3 5PR",LatLng:{lat:55.970603,lng:-3.213589},imgSrc:"images/superstar.jpg"},{show:"Hardeep Singh Kohli",venue:"Pleasance Dome",address:"Potterrow",zipcode:"EH8 9AL",LatLng:{lat:55.946225,lng:-3.187396},imgSrc:"images/hardeepsingh.jpg"},{show:"Stewart Lee",venue:"The Stand Comedy Club",address:"5 York Place",zipcode:"EH1 3EB",LatLng:{lat:55.95571,lng:-3.192245},imgSrc:"images/stewartlee.jpg"},{show:"Paul Merton",venue:"Pleasance Courtyard",address:"60 Pleasance",zipcode:"EH8 9TJ",LatLng:{lat:55.947379,lng:-3.182045},imgSrc:"images/paulmerton.jpg"},{show:"Puddles Pity Party",venue:"Assembly George Square Gardens",address:"George Square",zipcode:"EH8 9HL",LatLng:{lat:55.944257,lng:-3.189112},imgSrc:"images/puddles.jpg"},{show:"Joe Stilgoe",venue:"Assembly Checkpoint",address:"3 Bristo Place",zipcode:"EH1 1EY",LatLng:{lat:55.946298,lng:-3.189972},imgSrc:"images/joestilgoe.jpg"}],menu=document.querySelector(".menu"),venueMenu=document.querySelector(".venueMenu"),drawer=document.querySelector(".nav");menu.addEventListener("click",function(e){drawer.classList.toggle("open"),e.stopPropagation()}),venueMenu.addEventListener("click",function(){drawer.classList.remove("open")});var Venue=function(e){var i=this;this.show=ko.observable(e.show),this.venue=ko.observable(e.venue),this.address=e.address,this.zipcode=e.zipcode,this.latlng=e.latlng,this.imgSrc=e.imgSrc,this.wikiQuery="https://en.wikipedia.org/w/api.php?action=opensearch&search="+this.show()+"&prop=revisions&rvprop=content&format=json&callback=wikiCallback",this.contentString="<p><img height='120px' src ="+this.imgSrc+"><br/>"+this.show()+"<br/>"+this.venue()+"<br/>"+this.address+"<br/>%wiki%</br>Information provided by Wikipedia</p>",i.marker=new google.maps.Marker({position:e.LatLng,map:map,animation:google.maps.Animation.DROP,title:e.show});var n=$.ajax({url:this.wikiQuery,dataType:"jsonp"});n.done(function(e){var n=e[0],o="http://en.wikipedia.org/wiki/"+n,t='<a href="'+o+'">'+i.show()+"</a>";i.content=i.contentString.replace("%wiki%",t),i.marker.addListener("click",function(){infowindow.setContent(i.content),infowindow.open(map,this),null!==this.getAnimation()?this.setAnimation(null):this.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){i.marker.setAnimation(null)},750),drawer.classList.remove("open")})}),n.fail(function(){alert("Your wikipedia request has failed")}),this.pop=function(e){google.maps.event.trigger(i.marker,"click")}},ViewModel=function(){var e=this;this.searchTerm=ko.observable(""),this.showList=ko.observableArray([]),initialShows.forEach(function(i){e.showList.push(new Venue(i))}),this.filteredList=ko.computed(function(){var i=e.searchTerm().toLowerCase();return i?ko.utils.arrayFilter(e.showList(),function(e){var n=e.show().toLowerCase(),o=n.indexOf(i)>=0;return e.marker.setVisible(o),infowindow.close(),o}):(e.showList().forEach(function(e){e.marker.setVisible(!0)}),e.showList())},e)},mapFail=function(){alert("GoogleMaps failed to load.  Try refreshing your browser.")};